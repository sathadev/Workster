<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WorkSter - สมัครบัญชีผู้ใช้</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a62630f63f.js" crossorigin="anonymous"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap');

    html, body {
      font-family: "Noto Sans Thai", sans-serif;
    }

    .sidebar {
      background-color: #f8f9fa;
      min-height: 100vh;
      padding-top: 20px;
    }

    .sidebar a {
      display: block;
      padding: 10px 20px;
      color: #000;
      text-decoration: none;
    }

    .sidebar a:hover {
      background-color: #e2e6ea;
      border-radius: 5px;
    }

    .registration-card {
      max-width: 800px;
      margin: 50px 0 50px 20px; /* ชิดซ้าย มี margin-left 20px */
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .form-label-custom {
      min-width: 120px;
      text-align: right;
      padding-right: 15px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .form-control-custom {
      flex-grow: 1;
    }

    .row-custom {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>

  <nav class="navbar navbar-dark" style="background-color: #1E56A0; padding: 10px;">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1 fs-4">WorkSter</span>
      <span class="text-white fs-3"><i class="fa-solid fa-circle-user"></i></span>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2 sidebar">
        </div>
      <div class="col-md-10 p-4">
        <h3 class="mb-4">สมัครบัญชีผู้ใช้</h3>

        <div class="card registration-card" id="step1">
          <h5 class="card-title mb-4">ขั้นตอนที่ 1: ข้อมูลการเข้าใช้งานระบบ</h5>
          <form id="formStep1">
            <div class="row-custom">
              <label for="username" class="form-label-custom">Username :</label>
              <input type="text" class="form-control form-control-custom" id="username" required>
            </div>
            <div class="row-custom">
              <label for="email" class="form-label-custom">Email :</label>
              <input type="email" class="form-control form-control-custom" id="email" required>
            </div>
            <div class="row-custom">
              <label for="password" class="form-label-custom">Password :</label>
              <input type="password" class="form-control form-control-custom" id="password" required>
            </div>
            <div class="d-flex justify-content-end mt-4">
              <button type="button" class="btn btn-secondary" onclick="goToStep(2)">ถัดไป</button>
            </div>
          </form>
        </div>

        <div class="card registration-card d-none" id="step2">
          <h5 class="card-title mb-4">ขั้นตอนที่ 2: ข้อมูลผู้ใช้</h5>
          <form id="formStep2">
            <div class="row-custom">
              <label for="fullName" class="form-label-custom">ชื่อ - นามสกุล :</label>
              <input type="text" class="form-control form-control-custom" id="fullName" required>
            </div>
            <div class="row-custom">
              <label for="phone" class="form-label-custom">เบอร์โทร :</label>
              <input type="tel" class="form-control form-control-custom" id="phone" required>
            </div>
            <hr class="my-3">
            <h6 class="mb-3">ข้อมูลที่อยู่:</h6>
            <div class="row-custom">
              <label for="empAddressNo" class="form-label-custom">เลขที่ :</label>
              <input type="text" class="form-control form-control-custom" id="empAddressNo">
            </div>
            <div class="row-custom">
              <label for="empMoo" class="form-label-custom">หมู่ :</label>
              <input type="text" class="form-control form-control-custom" id="empMoo">
            </div>
            <div class="row-custom">
              <label for="empBuilding" class="form-label-custom">อาคาร/หมู่บ้าน :</label>
              <input type="text" class="form-control form-control-custom" id="empBuilding">
            </div>
            <div class="row-custom">
              <label for="empStreet" class="form-label-custom">ถนน :</label>
              <input type="text" class="form-control form-control-custom" id="empStreet">
            </div>
            <div class="row-custom">
              <label for="empSoi" class="form-label-custom">ซอย :</label>
              <input type="text" class="form-control form-control-custom" id="empSoi">
            </div>
            <div class="row-custom">
              <label for="empProvince" class="form-label-custom">จังหวัด :</label>
              <select class="form-select form-control-custom" id="empProvince" required>
                <option value="">เลือกจังหวัด</option>
              </select>
            </div>
            <div class="row-custom">
              <label for="empDistrict" class="form-label-custom">อำเภอ/เขต :</label>
              <select class="form-select form-control-custom" id="empDistrict" required disabled>
                <option value="">เลือกอำเภอ/เขต</option>
              </select>
            </div>
            <div class="row-custom">
              <label for="empSubdistrict" class="form-label-custom">ตำบล/แขวง :</label>
              <select class="form-select form-control-custom" id="empSubdistrict" required disabled>
                <option value="">เลือกตำบล/แขวง</option>
              </select>
            </div>
            <div class="row-custom">
              <label for="empZipCode" class="form-label-custom">รหัสไปรษณีย์ :</label>
              <input type="text" class="form-control form-control-custom" id="empZipCode" readonly>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <button type="button" class="btn btn-light border" onclick="goToStep(1)">ย้อนกลับ</button>
              <button type="button" class="btn btn-secondary" onclick="goToStep(3)">ถัดไป</button>
            </div>
          </form>
        </div>

        <div class="card registration-card d-none" id="step3">
          <h5 class="card-title mb-4">ขั้นตอนที่ 3: ข้อมูลบริษัท</h5>
          <form id="formStep3">
            <div class="row-custom">
              <label for="companyName" class="form-label-custom">ชื่อบริษัท :</label>
              <input type="text" class="form-control form-control-custom" id="companyName" required>
            </div>
            <div class="row-custom">
              <label for="companyAddressNo" class="form-label-custom">เลขที่ :</label>
              <input type="text" class="form-control form-control-custom" id="companyAddressNo">
            </div>
            <div class="row-custom">
              <label for="companyMoo" class="form-label-custom">หมู่ :</label>
              <input type="text" class="form-control form-control-custom" id="companyMoo">
            </div>
            <div class="row-custom">
              <label for="companyBuilding" class="form-label-custom">อาคาร/หมู่บ้าน :</label>
              <input type="text" class="form-control form-control-custom" id="companyBuilding">
            </div>
            <div class="row-custom">
              <label for="companyStreet" class="form-label-custom">ถนน :</label>
              <input type="text" class="form-control form-control-custom" id="companyStreet">
            </div>
            <div class="row-custom">
              <label for="companySoi" class="form-label-custom">ซอย :</label>
              <input type="text" class="form-control form-control-custom" id="companySoi">
            </div>
            <div class="row-custom">
              <label for="companySubdistrict" class="form-label-custom">ตำบล/แขวง :</label>
              <input type="text" class="form-control form-control-custom" id="companySubdistrict" required>
            </div>
            <div class="row-custom">
              <label for="companyDistrict" class="form-label-custom">อำเภอ/เขต :</label>
              <input type="text" class="form-control form-control-custom" id="companyDistrict" required>
            </div>
            <div class="row-custom">
              <label for="companyProvince" class="form-label-custom">จังหวัด :</label>
              <input type="text" class="form-control form-control-custom" id="companyProvince" required>
            </div>
            <div class="row-custom">
              <label for="companyZipCode" class="form-label-custom">รหัสไปรษณีย์ :</label>
              <input type="text" class="form-control form-control-custom" id="companyZipCode" required>
            </div>
            <div class="row-custom">
              <label for="companyPhone" class="form-label-custom">เบอร์โทรบริษัท :</label>
              <input type="tel" class="form-control form-control-custom" id="companyPhone">
            </div>
            <div class="row-custom">
              <label for="companyEmail" class="form-label-custom">อีเมลบริษัท :</label>
              <input type="email" class="form-control form-control-custom" id="companyEmail">
            </div>
            <div class="row-custom">
              <label for="companyDescription" class="form-label-custom">รายละเอียดบริษัท :</label>
              <textarea class="form-control form-control-custom" id="companyDescription" rows="3"></textarea>
            </div>
            <div class="d-flex justify-content-between mt-4">
              <button type="button" class="btn btn-light border" onclick="goToStep(2)">ย้อนกลับ</button>
              <button type="submit" class="btn btn-success">ยืนยันการสมัคร</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>

  <script>
    const registrationData = {};
    let allProvincesData = []; // เก็บข้อมูลจังหวัด อำเภอ ตำบลทั้งหมดจาก API

    // Elements ของ Dropdown ที่อยู่พนักงาน
    const empProvinceSelect = document.getElementById('empProvince');
    const empDistrictSelect = document.getElementById('empDistrict');
    const empSubdistrictSelect = document.getElementById('empSubdistrict');
    const empZipCodeInput = document.getElementById('empZipCode');

    // โหลดข้อมูลจังหวัด อำเภอ ตำบล เมื่อหน้าโหลดเสร็จ
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('https://raw.githubusercontent.com/kongvut/thai-province-data/master/api_province_with_amphure_tambon.json');
        allProvincesData = await response.json();
        populateProvinces(); // เรียกฟังก์ชันเติมข้อมูลจังหวัด
      } catch (error) {
        console.error('Error fetching province data:', error);
        alert('เกิดข้อผิดพลาดในการโหลดข้อมูลจังหวัด โปรดลองรีเฟรชหน้าใหม่');
      }
    });

    // ฟังก์ชันเติมข้อมูลจังหวัดใน Dropdown
    function populateProvinces() {
      empProvinceSelect.innerHTML = '<option value="">เลือกจังหวัด</option>'; // Clear existing options
      allProvincesData.forEach(province => {
        const option = document.createElement('option');
        option.value = province.id;
        option.textContent = province.name_th;
        empProvinceSelect.appendChild(option);
      });
      empDistrictSelect.innerHTML = '<option value="">เลือกอำเภอ/เขต</option>';
      empSubdistrictSelect.innerHTML = '<option value="">เลือกตำบล/แขวง</option>';
      empDistrictSelect.disabled = true;
      empSubdistrictSelect.disabled = true;
      empZipCodeInput.value = '';
    }

    // Event Listener เมื่อเลือกจังหวัด
    empProvinceSelect.addEventListener('change', (event) => {
      const selectedProvinceId = event.target.value;
      empDistrictSelect.innerHTML = '<option value="">เลือกอำเภอ/เขต</option>';
      empSubdistrictSelect.innerHTML = '<option value="">เลือกตำบล/แขวง</option>';
      empZipCodeInput.value = '';
      empDistrictSelect.disabled = true;
      empSubdistrictSelect.disabled = true;

      if (selectedProvinceId) {
        const selectedProvince = allProvincesData.find(p => p.id === parseInt(selectedProvinceId));
        if (selectedProvince && selectedProvince.amphure) {
          selectedProvince.amphure.forEach(amphure => {
            const option = document.createElement('option');
            option.value = amphure.id;
            option.textContent = amphure.name_th;
            empDistrictSelect.appendChild(option);
          });
          empDistrictSelect.disabled = false;
        }
      }
    });

    // Event Listener เมื่อเลือกอำเภอ/เขต
    empDistrictSelect.addEventListener('change', (event) => {
      const selectedDistrictId = event.target.value;
      empSubdistrictSelect.innerHTML = '<option value="">เลือกตำบล/แขวง</option>';
      empZipCodeInput.value = '';
      empSubdistrictSelect.disabled = true;

      if (selectedDistrictId) {
        // หาจังหวัดที่เลือกอยู่ก่อน
        const selectedProvinceId = empProvinceSelect.value;
        const selectedProvince = allProvincesData.find(p => p.id === parseInt(selectedProvinceId));

        if (selectedProvince && selectedProvince.amphure) {
          const selectedAmphure = selectedProvince.amphure.find(a => a.id === parseInt(selectedDistrictId));
          if (selectedAmphure && selectedAmphure.tambon) {
            selectedAmphure.tambon.forEach(tambon => {
              const option = document.createElement('option');
              option.value = tambon.id;
              option.textContent = tambon.name_th;
              empSubdistrictSelect.appendChild(option);
            });
            empSubdistrictSelect.disabled = false;
          }
        }
      }
    });

    // Event Listener เมื่อเลือกตำบล/แขวง
    empSubdistrictSelect.addEventListener('change', (event) => {
      const selectedSubdistrictId = event.target.value;
      empZipCodeInput.value = '';

      if (selectedSubdistrictId) {
        const selectedProvinceId = empProvinceSelect.value;
        const selectedDistrictId = empDistrictSelect.value;

        const selectedProvince = allProvincesData.find(p => p.id === parseInt(selectedProvinceId));
        if (selectedProvince && selectedProvince.amphure) {
          const selectedAmphure = selectedProvince.amphure.find(a => a.id === parseInt(selectedDistrictId));
          if (selectedAmphure && selectedAmphure.tambon) {
            const selectedTambon = selectedAmphure.tambon.find(t => t.id === parseInt(selectedSubdistrictId));
            if (selectedTambon && selectedTambon.zip_code) {
              empZipCodeInput.value = selectedTambon.zip_code;
            }
          }
        }
      }
    });


    function goToStep(step) {
      // ตรวจสอบความถูกต้องของข้อมูลใน Step ปัจจุบันก่อนไป Step ถัดไป
      if (step === 2) {
        const form1 = document.getElementById('formStep1');
        if (!form1.checkValidity()) {
          form1.reportValidity(); // แสดงข้อความ error ของ browser
          return;
        }
        // เก็บข้อมูล Step 1
        registrationData.username = document.getElementById('username').value;
        registrationData.email = document.getElementById('email').value;
        registrationData.password = document.getElementById('password').value;
      } else if (step === 3) {
        const form2 = document.getElementById('formStep2');
        if (!form2.checkValidity()) {
          form2.reportValidity();
          return;
        }
        // เก็บข้อมูล Step 2 (ข้อมูลผู้ใช้และที่อยู่)
        registrationData.fullName = document.getElementById('fullName').value;
        registrationData.phone = document.getElementById('phone').value;
        registrationData.empAddressNo = document.getElementById('empAddressNo').value;
        registrationData.empMoo = document.getElementById('empMoo').value;
        registrationData.empBuilding = document.getElementById('empBuilding').value;
        registrationData.empStreet = document.getElementById('empStreet').value;
        registrationData.empSoi = document.getElementById('empSoi').value;
        
        // **เก็บค่าชื่อ (text) จาก dropdown แทนที่จะเป็น ID**
        registrationData.empSubdistrict = empSubdistrictSelect.options[empSubdistrictSelect.selectedIndex].text;
        registrationData.empDistrict = empDistrictSelect.options[empDistrictSelect.selectedIndex].text;
        registrationData.empProvince = empProvinceSelect.options[empProvinceSelect.selectedIndex].text;
        
        registrationData.empZipCode = empZipCodeInput.value;
      }

      // ซ่อนทุก Steps
      document.getElementById('step1').classList.add('d-none');
      document.getElementById('step2').classList.add('d-none');
      document.getElementById('step3').classList.add('d-none');

      // แสดง Step ที่ต้องการ
      document.getElementById('step' + step).classList.remove('d-none');
    }

    // Event Listener สำหรับ Step 3 (Submit สุดท้าย)
    document.getElementById('formStep3').addEventListener('submit', function(e) {
      e.preventDefault();
      const form3 = document.getElementById('formStep3');
      if (!form3.checkValidity()) {
        form3.reportValidity();
        return;
      }

      // เก็บข้อมูล Step 3 (ข้อมูลบริษัท)
      registrationData.companyName = document.getElementById('companyName').value;
      registrationData.companyAddressNo = document.getElementById('companyAddressNo').value;
      registrationData.companyMoo = document.getElementById('companyMoo').value;
      registrationData.companyBuilding = document.getElementById('companyBuilding').value;
      registrationData.companyStreet = document.getElementById('companyStreet').value;
      registrationData.companySoi = document.getElementById('companySoi').value;
      registrationData.companySubdistrict = document.getElementById('companySubdistrict').value;
      registrationData.companyDistrict = document.getElementById('companyDistrict').value;
      registrationData.companyProvince = document.getElementById('companyProvince').value;
      registrationData.companyZipCode = document.getElementById('companyZipCode').value;
      registrationData.companyPhone = document.getElementById('companyPhone').value;
      registrationData.companyEmail = document.getElementById('companyEmail').value;
      registrationData.companyDescription = document.getElementById('companyDescription').value;


      console.log('ข้อมูลทั้งหมดที่ต้องส่ง:', registrationData);
      alert('สมัครบัญชีสำเร็จ 🎉');
      // ที่นี่คุณจะส่ง `registrationData` ไปยัง Backend API
      /*
      fetch('/api/register-admin-with-company', { // เปลี่ยนเป็น endpoint ของคุณ
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(registrationData),
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        alert('สมัครบัญชีสำเร็จ 🎉');
        // อาจจะ redirect ไปหน้า login
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('เกิดข้อผิดพลาดในการสมัคร กรุณาลองอีกครั้ง');
      });
      */
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>