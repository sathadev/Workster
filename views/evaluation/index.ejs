<%- include('../partials/header') %>
  <%- include('../partials/navbar') %>

    <div class="col-md-10 p-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold">การประเมินผล</h4>
        <button class="btn btn-outline-secondary" onclick="window.location='/evaluation/history'">
          <i class="fa-plus"></i> ประวัติการประเมิน
        </button>
      </div>
      <p>หน้าหลัก</p>

      <div class="input-group mb-3 w-50">
        <input type="text" class="form-control" placeholder="ค้นหา" aria-label="ค้นหา">
        <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
      </div>

      <table class="table table-hover table-bordered text-center align-middle">
        <thead class="table-light">
          <tr>
            <th>ชื่อ - สกุล</th>
            <th>ตำแหน่ง</th>
            <th>การประเมินผล</th>
          </tr>
        </thead>
        <tbody>
          <% employees.forEach(emp=> { %>
            <tr>
              <td>
                <%= emp.emp_name %>
              </td>
              <td>
                <%= emp.jobpos_name %>
              </td>
              <td>
                <button class="btn btn-primary rounded-pill px-3 btn-evaluate" data-emp-id="<%= emp.emp_id %>">
                  ประเมินผล
                </button>
              </td>


            </tr>
            <% }) %>
        </tbody>

      </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="selfEvalModal" tabindex="-1" aria-labelledby="selfEvalModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-warning">
            <h5 class="modal-title" id="selfEvalModalLabel">แจ้งเตือน</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด"></button>
          </div>
          <div class="modal-body">
            คุณไม่สามารถประเมินตัวเองได้
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
          </div>
        </div>
      </div>
    </div>


    <script>
      const currentUserId = <%= JSON.stringify(currentUserId) %>;

      document.addEventListener('DOMContentLoaded', () => {
        const evalButtons = document.querySelectorAll('.btn-evaluate');

        evalButtons.forEach(button => {
          button.addEventListener('click', () => {
            const empId = Number(button.getAttribute('data-emp-id'));
            if (empId === currentUserId) {
              const modal = new bootstrap.Modal(document.getElementById('selfEvalModal'));
              modal.show();
            } else {
              window.location.href = `/evaluation/form?id=${empId}`;
            }
          });
        });
      });
    </script>


    <%- include('../partials/footer') %>